<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
<title>Fixed Toolbar with Editable Content</title>
<style>
  body {
  margin: 0px;
}

#editor {
  padding: 5px 20px;
}

#editor:focus {
  outline: 2px solid transparent;
}

#toolbar-wrap {
  position: sticky;
  top: 0px;
  height: 60px;
  width: 100%;
}

#toolbar {
  position: absolute;
  left: 0px;
  right: 0px;
  padding: 15px;
  background-color: #f1f5f9;
}

#toolbar.down {
  transform: translateY(0px); /* Изначальное положение */
  transition: transform 500ms cubic-bezier(0.4, 0, 0.2, 1);
}

.button {
  border-radius: 5px;
  background-color: transparent;
  border: 0px;
  padding: 3px 5px;
  line-height: 0px;
  display: inline-block;
  margin: 1px;
  cursor: pointer;
}

.button:hover {
  background-color: #e2e8f0;
}
</style>
<div id="toolbar-wrap">
  <div id="toolbar">
    <button class="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M8 11h4.5a2.5 2.5 0 1 0 0-5H8v5zm10 4.5a4.5 4.5 0 0 1-4.5 4.5H6V4h6.5a4.5 4.5 0 0 1 3.256 7.606A4.498 4.498 0 0 1 18 15.5zM8 13v5h5.5a2.5 2.5 0 1 0 0-5H8z"/></svg></button>
    <div class="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M15 20H7v-2h2.927l2.116-12H9V4h8v2h-2.927l-2.116 12H15z"/></svg></div>
    <div class="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M8 3v9a4 4 0 1 0 8 0V3h2v9a6 6 0 1 1-12 0V3h2zM4 20h16v2H4v-2z"/></svg></div>
  </div>
</div>

<div id="editor" contentEditable="true">
  <p>This is a very long editable area.</p>
  <p>The problem is, when you focus in this area on an iOS device, a keyboard pops up and that beautiful fixed toolbar at the top gets hidden.</p>
  <p>You will need to fork this pen and view in debug mode on an iOS device to see the fix in action (so that you are not viewing it inside an iframe).</p>
  <p>You might need to scroll down a bit to see the header disappear.</p>
  <p>Let's fix this problem, using JavaScript!</p>
  <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p> <p>...</p><p>...</p>
    <p>This is a very long editable area.</p>
  <p>The problem is, when you focus in this area on an iOS device, a keyboard pops up and that beautiful fixed toolbar at the top gets hidden.</p>
  <p>Let's fix this problem, using JavaScript!</p>
  
</div>
<script>
  const toolbarWrap = document.getElementById('toolbar-wrap');
  const toolbar = document.getElementById('toolbar');
  const editor = document.getElementById('editor');
  
  // Функция debounce
  function debounce(func, wait) {
    let timeout;
  
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
  
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }
  
  // Если элементы существуют, добавляем логику
  if (toolbarWrap && toolbar && editor) {
    let fixPosition = 0;
  
    // Устанавливаем transform для toolbar
    const setTransform = () => {
      const newPosition = toolbarWrap.getBoundingClientRect().top;
      if (newPosition < -1) {
        toolbar.classList.add("down");
        fixPosition = Math.abs(newPosition);
        if (window.innerHeight + window.pageYOffset >= document.body.offsetHeight) {
          fixPosition -= 2;
        }
        toolbar.style.transform = `translateY(${fixPosition}px)`;
      } else {
        toolbar.classList.remove("down");
        toolbar.style.transform = 'translateY(0px)';
      }
    };
  
    // Создаем debounced версию setTransform
    const setTransformDebounced = debounce(setTransform, 150);
  
    // Функция, которая показывает toolbar
    const showToolbar = () => {
      if (fixPosition > 0) {
        toolbar.classList.remove("down");
        fixPosition = 0;
        toolbar.style.transform = 'translateY(0px)';
      }
      setTransformDebounced();
    };
  
    // Добавляем обработчики событий
    window.addEventListener("scroll", setTransformDebounced);
    window.addEventListener("resize", setTransformDebounced);
    editor.addEventListener("blur", showToolbar);
  }
  </script>  
</body>
</html>